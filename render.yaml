services:
  - type: web
    name: weather-dashboard
    runtime: docker
    plan: starter
    region: oregon
    branch: main
    dockerfilePath: ./Dockerfile
    dockerContext: .
    
    # Environment variables
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_TELEMETRY_DISABLED
        value: "1"
      - key: PORT
        value: "3000"
      - key: HOSTNAME
        value: "0.0.0.0"
    
    # Health check configuration
    healthCheckPath: /
    
    # Auto-deploy settings
    autoDeploy: true
    
    # Build settings
    buildFilter:
      paths:
        - src/**
        - public/**
        - package.json
        - package-lock.json
        - next.config.js
        - tailwind.config.js
        - postcss.config.js
        - tsconfig.json
        - Dockerfile
      ignoredPaths:
        - "*.md"
        - docs/**
        - scripts/**
        - test-*.js
        - "*.Zone.Identifier"
    
    # Scaling configuration
    scaling:
      minInstances: 1
      maxInstances: 3
      targetMemoryPercent: 70
      targetCPUPercent: 70
    
    # Disk configuration
    disk:
      name: weather-dashboard-disk
      mountPath: /app/data
      sizeGB: 1
    
    # Headers for security and performance
    headers:
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-XSS-Protection
        value: "1; mode=block"
      - path: /*
        name: Referrer-Policy
        value: strict-origin-when-cross-origin
      - path: /static/*
        name: Cache-Control
        value: "public, max-age=31536000, immutable"
      - path: /_next/static/*
        name: Cache-Control
        value: "public, max-age=31536000, immutable"
    
    # Routes configuration
    routes:
      - type: rewrite
        source: /api/*
        destination: /api/*
      - type: rewrite
        source: /*
        destination: /index.html
